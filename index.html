<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mando X - Professional Edition</title>
    <style>
        :root { --bg: #000; --card: #121212; --text: #fff; --border: #333; --primary: #2ecc71; --gold: #f1c40f; --red: #e74c3c; }
        .light-mode { --bg: #f0f2f5; --card: #fff; --text: #000; --border: #ddd; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }

        /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #authPage { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--card); padding: 35px; border-radius: 25px; border: 2px solid var(--primary); width: 100%; max-width: 400px; text-align: center; }
        .auth-card input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid var(--border); background: #000; color: #fff; outline: none; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-menu { position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background: var(--card); z-index: 5000; padding: 25px; transition: 0.4s; border-left: 1px solid var(--border); box-shadow: -10px 0 30px #000; }
        .side-menu.active { right: 0; }
        .side-menu.ltr { right: auto; left: -100%; }
        .side-menu.ltr.active { left: 0; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .header { position: sticky; top: 0; background: var(--bg); padding: 12px; border-bottom: 1px solid var(--border); z-index: 1000; }
        .tabs { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .tab { padding: 8px 18px; border-radius: 20px; background: var(--card); border: 1px solid var(--border); cursor: pointer; white-space: nowrap; color: #888; font-size: 13px; }
        .tab.active { background: var(--primary); color: #000; font-weight: bold; }

        /* Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª */
        .post { border-bottom: 8px solid var(--card); background: var(--bg); }
        .post-media { width: 100%; max-height: 500px; object-fit: contain; background: #000; display: block; }
        .poll-option { background: var(--card); border: 1px solid var(--border); padding: 15px; margin-top: 10px; border-radius: 12px; cursor: pointer; position: relative; overflow: hidden; }
        .poll-bar { position: absolute; left: 0; top: 0; height: 100%; background: rgba(46, 204, 113, 0.2); width: 0%; transition: 1s; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ²Ø± X */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 6000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: var(--card); padding: 25px; border-radius: 20px; width: 100%; max-width: 450px; border: 1px solid var(--primary); position: relative; max-height: 90vh; overflow-y: auto; }
        .close-x { position: absolute; top: 10px; left: 15px; font-size: 35px; color: var(--red); cursor: pointer; font-weight: bold; z-index: 100; }

        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© */
        .upload-choice { flex: 1; background: #1a1a1a; border: 1px solid var(--border); padding: 20px; border-radius: 15px; cursor: pointer; text-align: center; font-size: 14px; }
        .upload-choice:hover { border-color: var(--primary); transform: translateY(-3px); }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 75px; background: var(--bg); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 2000; }
        .main-plus { background: var(--primary); width: 65px; height: 65px; border-radius: 50%; border: none; font-size: 35px; color: #000; cursor: pointer; box-shadow: 0 0 20px rgba(46, 204, 113, 0.4); }

        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
        .owner-txt { color: var(--gold) !important; font-weight: bold; text-shadow: 0 0 10px rgba(241,196,15,0.5); }
        .hidden { display: none !important; }
        .avatar-circle { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
        textarea { resize: none; }
    </style>
</head>
<body id="bodyTag">

    <div id="authPage">
        <div class="auth-card">
            <h1 style="color:var(--primary); margin-bottom:10px;">Mando X</h1>
            <p style="font-size: 12px; color: #666; margin-bottom: 20px;">Redmi A3X Optimized</p>
            <input type="text" id="uName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="uPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="login()" style="width:100%; padding:15px; background:var(--primary); border:none; border-radius:12px; font-weight:bold; cursor:pointer;">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="googleAuth()" style="width:100%; padding:12px; background:#fff; color:#000; border:none; border-radius:12px; margin-top:10px; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:8px;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="18"> Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø¹Ø¨Ø± Google
            </button>
        </div>
    </div>

    <div id="sideMenu" class="side-menu">
        <h3 data-tr="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
        <hr style="margin:20px 0; border:0.5px solid var(--border);">
        <div style="text-align:center; margin-bottom:25px;">
            <div style="position:relative; display:inline-block;">
                <img id="sideAva" class="avatar-circle" style="width:110px; height:110px; border-width:3px;">
                <button onclick="document.getElementById('changePicInp').click()" style="position:absolute; bottom:0; right:0; background:var(--primary); border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;">ğŸ“·</button>
            </div>
            <p id="sideName" style="margin-top:15px; font-size:20px; font-weight:bold;"></p>
            <input type="file" id="changePicInp" class="hidden" accept="image/*" onchange="updateProfilePic(this)">
        </div>
        <div style="margin-bottom:15px;">
            <label data-tr="langLabel" style="font-size:13px; color:#888;">Ø§Ù„Ù„ØºØ©:</label>
            <select onchange="changeLanguage(this.value)" style="width:100%; padding:12px; margin-top:5px; border-radius:10px; background:#000; color:#fff; border:1px solid #444;">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
            </select>
        </div>
        <button onclick="toggleDarkMode()" style="width:100%; padding:14px; background:#333; color:#fff; border:none; border-radius:10px; margin-top:10px; cursor:pointer;" data-tr="darkBtn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ—</button>
        <button onclick="logout()" style="width:100%; padding:14px; background:var(--red); color:#fff; border:none; border-radius:10px; margin-top:10px; cursor:pointer;" data-tr="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ğŸšª</button>
        <button onclick="toggleMenu()" style="width:100%; padding:12px; background:transparent; color:#fff; border:1px solid #444; border-radius:10px; margin-top:15px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div id="mainApp" class="hidden">
        <div class="header">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div class="logo" style="letter-spacing:1px;">MANDO <span style="color:#fff;">X</span></div>
                <img id="headAva" class="avatar-circle" onclick="toggleMenu()" style="cursor:pointer;">
            </div>
            <div class="tabs">
                <div class="tab active" onclick="setFilter('all', this)" data-tr="all">Ø§Ù„ÙƒÙ„</div>
                <div class="tab" onclick="setFilter('poll', this)" data-tr="polls">ØªØµÙˆÙŠØªØ§Øª</div>
                <div class="tab" onclick="setFilter('video', this)" data-tr="vids">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>
                <div class="tab" onclick="setFilter('music', this)" data-tr="songs">Ø£ØºØ§Ù†ÙŠ</div>
                <div class="tab" onclick="setFilter('image', this)" data-tr="imgs">ØµÙˆØ±</div>
                <div class="tab" onclick="setFilter('text', this)" data-tr="posts">Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
            </div>
        </div>
        <div id="feed"></div>
        <div class="nav-bar">
            <button onclick="openModal('text')" style="background:none; border:none; font-size:26px; cursor:pointer;">ğŸ“</button>
            <button class="main-plus" onclick="openChoiceModal()">+</button>
            <button onclick="openModal('poll')" style="background:none; border:none; font-size:26px; cursor:pointer;">ğŸ“Š</button>
        </div>
    </div>

    <div id="pModal" class="modal">
        <div class="modal-card">
            <span class="close-x" onclick="closeModal()">&times;</span>
            <div id="modalInner"></div>
        </div>
    </div>

    <script>
        const OWNER_NAME = "Mando_Owner";
        let session = JSON.parse(localStorage.getItem('mando_session'));
        let posts = JSON.parse(localStorage.getItem('mando_posts')) || [];
        let currentFilter = 'all';
        let tempMedia = null;

        const trans = {
            ar: { settings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", changePic:"ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©", langLabel:"Ø§Ù„Ù„ØºØ©:", darkBtn:"Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ", logout:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", all:"Ø§Ù„ÙƒÙ„", polls:"ØªØµÙˆÙŠØªØ§Øª", vids:"ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª", songs:"Ø£ØºØ§Ù†ÙŠ", imgs:"ØµÙˆØ±", posts:"Ù…Ù†Ø´ÙˆØ±Ø§Øª" },
            en: { settings:"Settings", changePic:"Change Avatar", langLabel:"Language:", darkBtn:"Dark Mode", logout:"Logout", all:"All", polls:"Polls", vids:"Videos", songs:"Songs", imgs:"Photos", posts:"Posts" }
        };

        window.onload = () => {
            const u = localStorage.getItem('last_u'); const p = localStorage.getItem('last_p');
            if(u) document.getElementById('uName').value = u;
            if(p) document.getElementById('uPass').value = p;
            if(session) start();
        };

        function login() {
            const n = document.getElementById('uName').value.trim();
            const p = document.getElementById('uPass').value.trim();
            if(!n) return;
            session = { name: n, isOwner: (n === OWNER_NAME), avatar: "https://via.placeholder.com/100/2ecc71/fff?text="+n[0] };
            localStorage.setItem('mando_session', JSON.stringify(session));
            localStorage.setItem('last_u', n); localStorage.setItem('last_p', p);
            start();
        }

        function start() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updateUI(); render();
        }

        function updateUI() {
            document.getElementById('headAva').src = session.avatar;
            document.getElementById('sideAva').src = session.avatar;
            document.getElementById('sideName').innerText = session.name;
            if(session.isOwner) document.getElementById('sideName').classList.add("owner-txt");
        }

        function openChoiceModal() {
            const inner = document.getElementById('modalInner');
            inner.innerHTML = `
                <h3 style="text-align:center; margin-bottom:20px;">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h3>
                <div style="display:flex; gap:10px;">
                    <div class="upload-choice" onclick="triggerInput('vInp')">ğŸ¥<br>ÙÙŠØ¯ÙŠÙˆ</div>
                    <div class="upload-choice" onclick="triggerInput('iInp')">ğŸ–¼ï¸<br>ØµÙˆØ±Ø©</div>
                    <div class="upload-choice" onclick="triggerInput('mInp')">ğŸµ<br>Ø£ØºÙ†ÙŠØ©</div>
                </div>
                <input type="file" id="vInp" class="hidden" accept="video/*" onchange="handleFile(this, 'video', 'video')">
                <input type="file" id="iInp" class="hidden" accept="image/*" onchange="handleFile(this, 'image', 'image')">
                <input type="file" id="mInp" class="hidden" accept="audio/*" onchange="handleFile(this, 'music', 'image')">
            `;
            document.getElementById('pModal').style.display = 'flex';
        }

        function triggerInput(id) { document.getElementById(id).click(); }

        function handleFile(input, cat, type) {
            const file = input.files[0]; if(!file) return;
            const r = new FileReader();
            r.onload = (e) => {
                document.getElementById('modalInner').innerHTML = `
                    <h3>Ù†Ø´Ø± ${cat === 'video' ? 'ÙÙŠØ¯ÙŠÙˆ' : cat === 'music' ? 'Ø£ØºÙ†ÙŠØ©' : 'ØµÙˆØ±Ø©'}</h3>
                    <div style="background:#000; padding:10px; border-radius:10px; margin-top:10px; border:1px solid #333;">
                        <textarea id="desc" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹..." style="width:100%; height:80px; background:transparent; border:none; color:#fff; outline:none;"></textarea>
                    </div>
                    <button class="main-plus" style="width:100%; border-radius:10px; height:50px; margin-top:15px; box-shadow:none; font-size:18px;" onclick="saveP({type:'${type}', category:'${cat}', media:'${e.target.result}', text:document.getElementById('desc').value})">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
                `;
            };
            r.readAsDataURL(file);
        }

        function openModal(type) {
            tempMedia = null; const inner = document.getElementById('modalInner');
            if(type === 'text') {
                inner.innerHTML = `<h3>Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3><div style="background:#1a1a1a; border:1px solid #333; border-radius:15px; padding:12px; margin-top:15px; display:flex; align-items:center;"><textarea id="t" placeholder="Ù…Ø§Ø°Ø§ ÙŠØ¯ÙˆØ± ÙÙŠ Ø°Ù‡Ù†ÙƒØŸ" style="flex:1; background:transparent; border:none; color:#fff; outline:none;"></textarea><label style="font-size:26px; cursor:pointer;">ğŸ–¼ï¸<input type="file" class="hidden" accept="image/*" onchange="preI(this)"></label></div><img id="pv" style="width:100%; display:none; border-radius:10px; margin-top:10px; border:1px solid var(--primary);"><button class="main-plus" style="width:100%; border-radius:10px; height:50px; margin-top:15px; box-shadow:none;" onclick="saveP({type:tempMedia?'image':'text', category:'text', text:document.getElementById('t').value, media:tempMedia})">Ù†Ø´Ø±</button>`;
            } else {
                inner.innerHTML = `<h3>ØªØµÙˆÙŠØª ğŸ“Š</h3><div style="background:#1a1a1a; border:1px solid #333; border-radius:15px; padding:12px; margin-top:15px; display:flex; align-items:center;"><input id="q" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„..." style="flex:1; background:transparent; border:none; color:#fff; outline:none;"><label style="font-size:26px; cursor:pointer;">ğŸ–¼ï¸<input type="file" class="hidden" accept="image/*" onchange="preI(this)"></label></div><img id="pv" style="width:100%; display:none; border-radius:10px; margin-top:10px; border:1px solid var(--primary);"><div id="os"><input class="p-o" placeholder="Ø®ÙŠØ§Ø± 1" style="width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid #444; background:#000; color:#fff;"><input class="p-o" placeholder="Ø®ÙŠØ§Ø± 2" oninput="addO(this)" style="width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid #444; background:#000; color:#fff;"></div><button class="main-plus" style="width:100%; border-radius:10px; height:50px; margin-top:15px; box-shadow:none;" onclick="savePoll()">Ù†Ø´Ø± Ø§Ù„ØªØµÙˆÙŠØª</button>`;
            }
            document.getElementById('pModal').style.display = 'flex';
        }

        function preI(input) { const r = new FileReader(); r.onload = (e) => { tempMedia = e.target.result; const i = document.getElementById('pv'); i.src = tempMedia; i.style.display = 'block'; }; r.readAsDataURL(input.files[0]); }
        function addO(el) { const a = document.getElementById('os'); const inps = a.querySelectorAll('.p-o'); if(el === inps[inps.length-1] && inps.length < 6) { const n = document.createElement('input'); n.className = 'p-o'; n.placeholder = "Ø®ÙŠØ§Ø± " + (inps.length+1); n.oninput = function() { addO(this); }; n.style = "width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid #444; background:#000; color:#fff;"; a.appendChild(n); } }
        function saveP(data) { if(!data.text.trim() && !data.media) return; posts.unshift({ id: Date.now(), user: session.name, isOwner: session.isOwner, userPic: session.avatar, ...data, vRec: {} }); store(); }
        function savePoll() { const q = document.getElementById('q').value; const os = []; document.querySelectorAll('.p-o').forEach(i => { if(i.value.trim()) os.push({text: i.value, votes: 0}); }); if(!q.trim() && !tempMedia) return; saveP({ type: 'poll', category: 'poll', text: q, media: tempMedia, pollOpts: os }); }
        
        function render() {
            const f = document.getElementById('feed'); f.innerHTML = '';
            const filt = currentFilter === 'all' ? posts : posts.filter(p => p.category === currentFilter);
            filt.forEach(p => {
                let m = p.media ? (p.type==='video'?`<video src="${p.media}" class="post-media" controls></video>`:`<img src="${p.media}" class="post-media">`) : '';
                let pl = p.type==='poll' ? `<div style="padding:10px;">` + p.pollOpts.map((o,i)=>`<div class="poll-option" onclick="vote(${p.id},${i})"><div class="poll-bar" style="width:${calc(p,i)}%"></div><span style="position:relative; z-index:2;">${o.text} (${calc(p,i)}%)</span></div>`).join('') + `</div>` : '';
                f.innerHTML += `<div class="post">
                    <div style="padding:12px; display:flex; align-items:center; gap:12px;">
                        <img src="${p.userPic}" class="avatar-circle" style="width:38px; height:38px;">
                        <span class="${p.isOwner?'owner-txt':''}" style="font-size:15px;">${p.user}</span>
                    </div>
                    ${m}
                    <div style="padding:15px;">
                        <p style="white-space:pre-wrap; font-size:15px; line-height:1.5;">${p.text}</p>
                        ${pl}
                        ${(session.isOwner || p.user===session.name)?`<button onclick="del(${p.id})" style="color:var(--red); border:none; background:none; font-size:12px; margin-top:15px; cursor:pointer;">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>`:''}
                    </div>
                </div>`;
            });
        }

        function vote(id, i) { const p=posts.find(x=>x.id===id); if(p.vRec[session.name])return; p.pollOpts[i].votes++; p.vRec[session.name]=true; store(); }
        function calc(p, i) { const t=p.pollOpts.reduce((s,o)=>s+o.votes,0); return t===0?0:Math.round((p.pollOpts[i].votes/t)*100); }
        function store() { localStorage.setItem
